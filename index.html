<html>
    <head>
        <title></title>


        <script id="vertex-shader" type="x-shader/x-vertex">
            attribute vec4 vPosition;
            attribute float vPointSize;
            //uniform mat4 uRotation;
            uniform float u_pointsize;
            
            attribute vec4 vColor;
            varying vec4 fColor;
            
            attribute float vAtlasId;
            varying float fAtlasId;

            /*attribute vec4 layer0_vPosition;
            attribute vec4 layer1_vPosition;
            attribute vec4 layer2_vPosition;
            attribute vec4 layer3_vPosition;
            attribute vec4 layer4_vPosition;

            attribute float layer0_vPointSize;
            attribute float layer1_vPointSize;
            attribute float layer2_vPointSize;
            attribute float layer3_vPointSize;
            attribute float layer4_vPointSize;

            attribute vec4 float layer0_vColor;
            attribute vec4 float layer1_vColor;
            attribute vec4 float layer2_vColor;
            attribute vec4 float layer3_vColor;
            attribute vec4 float layer4_vColor;*/


            void main() {
                fColor = vColor;
                fAtlasId = vAtlasId;
                //gl_Position = uRotation * vPosition;
                gl_Position = vPosition;

                //gl_PointSize = u_pointsize;
                //gl_PointSize = vColor.r * u_pointsize; // cool!
                gl_PointSize = vPointSize;
            }
        </script>
        <script id="fragment-shader" type="x-shader/x-fragment">

            precision mediump float;


            uniform float u_time;
            varying vec4 fColor;
            varying float fAtlasId;
            //uniform sampler2D spriteTexture;  // texture we are drawing
            uniform sampler2D textureAtlas;  // texture we are drawing

            uniform vec2 textureAtlasSize;  // eg 64x32
            uniform vec2 imageSize;         // eg 16x16

            void main() {
                //gl_FragColor = vec4(abs(sin(u_time)),0.0,0.0,1.0);
                //vec2 u_resolution = vec2( 1024.0* abs(sin(u_time))   ,  1024.0* abs(cos(u_time)) ) ;
                //vec2 st = gl_FragCoord.xy/u_resolution;

                //gl_FragColor = fColor;
                //gl_FragColor = texture2D(spriteTexture, gl_PointCoord);



                float imageId = float(imageSize * fAtlasId);
                float imagesAcross = floor(textureAtlasSize.x / imageSize.x); // 128/64 = 1 images horizontal
                //vec2 imageCoord = vec2(mod(imageId, imagesAcross), floor(imageId / imagesAcross));
                vec2 imageCoord = vec2(imageId,0);
                vec2 uv = (imageCoord + imageSize * gl_PointCoord) / textureAtlasSize;
                
                if(fAtlasId > -1.0){
                    gl_FragColor = texture2D(textureAtlas, uv);
                }else{
                    gl_FragColor = fColor;
                }





            }
        </script>
        <script type="text/javascript" src="Common/webgl-utils.js"></script>
        <script type="text/javascript" src="Common/initShaders.js"></script>
        <script type="text/javascript" src="Common/flatten.js"></script>

        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <img src="/img/sprite_nums_1024x1024.png" id="icon" hidden />
        <img src="/assets_ignore/pixelspritefont 32.png" id="pixelfont" hidden />


        <canvas id="gl-canvas" width="800" height="800">
            Oops ... your browser doesn't support the HTML5 canvas element
        </canvas>

        <script src="stats.js"></script>
        <script src="js/ccapture/CCapture.all.min.js"></script>
        <script src="absulit.js"></script>
        <!-- <script src="js/screen.js" type="module"></script> -->
        <script src="https://unpkg.com/gpu.js@latest/dist/gpu-browser.min.js"></script>
        <script src="main.js" type="module"></script>
        <button id="downloadBtn">START CAPTURE</button>
    </body>
</html>
