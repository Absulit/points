<html>
    <head>
        <title>SIMPLE - index</title>


        <script id="vertex-shader" type="x-shader/x-vertex">
            attribute vec4 vPosition;
            attribute float vPointSize;

            attribute vec4 vColor;
            varying vec4 fColor;

            attribute float vAtlasId;
            varying float fAtlasId;


            void main() {
                fColor = vColor;
                fAtlasId = vAtlasId;

                gl_Position = vPosition;
                gl_PointSize = vPointSize;
            }
        </script>
        <script id="fragment-shader" type="x-shader/x-fragment">
            precision mediump float;

            uniform float utime;
            uniform float screenWidth;
            uniform float screenHeight;

            uniform float planetPoints;
            uniform float planetPointsLength;

            varying vec4 fColor;
            varying float fAtlasId;

            uniform sampler2D textureAtlas;  // texture we are drawing
            uniform vec2 textureAtlasSize;  // eg 64x32
            uniform vec2 imageSize;         // eg 16x16

            float fnusin(float speed){
                return sin(utime * speed) * .5;
            }

            float sdfSegment( in vec2 p, in vec2 a, in vec2 b ){
                vec2 pa = p-a, ba = b-a;
                float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );
                return length( pa - ba*h );
            }

            float line(vec2 uv, vec2 p1, vec2 p2, float pixelStroke){
                vec2 v1 = vec2(p1.x/screenWidth, 1.-p1.y/screenWidth);
                vec2 v2 = vec2(p2.x/screenHeight, 1.-p2.y/screenHeight);
                float d = sdfSegment(uv, v1, v2);
                float value = 1.0;
                if(d > pixelStroke/800.){
                    value = 0.;
                }
                return value;
            }

            void main() {
                vec4 finalColor;
                vec2 uv = gl_FragCoord.xy/800.;

                if(fAtlasId > -1.0){
                    float numColumns = floor(textureAtlasSize.x / imageSize.x); // 128/64 = 1 images horizontal
                    float x = mod(fAtlasId,numColumns);
                    float y = floor(fAtlasId/numColumns);

                    vec2 imageCoord = vec2(x*imageSize.x,y*imageSize.y);
                    vec2 uv = (imageCoord + imageSize * gl_PointCoord) / textureAtlasSize;
                    finalColor = texture2D(textureAtlas, uv);
                }else{
                    ////finalColor = fColor;
                    float cellSize = 20. + 10. * fnusin(1.);
                    float a = sin(uv.x  * cellSize) * sin(uv.y * cellSize);
                    float b = sin(uv.x * uv.y * 10. * 9.1 * .25 );
                    float c = fnusin(uv.x * uv.y * 10.);
                    float d = distance(a,b);
                    float f = d * uv.x * uv.y;
                    finalColor = vec4(a*d,f*c*a,f, 1.);

                    //float constant = .02;
                    //float wave = sin(uv.y * 20. + 5. * fnusin(1.55222) + utime);
                    //float b = sin(uv.x * 25. + 5. * fnusin(2.15654) + wave * fnusin(1.));
                    //finalColor = vec4(b);

                    //float a = mod(gl_FragCoord.x, 30.);
                    //float b = mod(gl_FragCoord.y, 30.);
                    //finalColor = vec4((1.-a) * (1.-b));

                    //float v = line(uv, vec2(10.,10.),  vec2(780.,780.), 1.  );
                    //finalColor = vec4(v);


                }
                gl_FragColor = finalColor;

            }
        </script>
        <script type="text/javascript" async src="../Common/webgl-utils.js"></script>
        <script type="text/javascript" async src="../Common/initShaders.js"></script>
        <script type="text/javascript" async src="../Common/flatten.js"></script>

        <link rel="stylesheet" async type="text/css" href="../style.css">
    </head>
    <body>
        <canvas id="gl-canvas" width="800" height="800">
            Oops ... your browser doesn't support the HTML5 canvas element
        </canvas>

        <script src="../stats.js"></script>
        <script src="../js/ccapture/CCapture.all.min.js"></script>
        <script src="../absulit.module.js" type="module"></script>
        <!-- <script src="js/screen.js" type="module"></script> -->
        <!-- <script src="https://unpkg.com/gpu.js@latest/dist/gpu-browser.min.js"></script> -->
        <script src="main.js" type="module"></script>

        <button id="downloadBtn">START CAPTURE</button>
        <div>
            <label for="slider-a">A</label>
            <input type="range" id="slider-a" name="slider-a" min="0" max="1" step=".001" value="0">
            <label for="slider-a">B</label>
            <input type="range" id="slider-b" name="slider-b" min="0" max="1" step=".001" value="0">
            <label for="slider-a">C</label>
            <input type="range" id="slider-c" name="slider-c" min="0" max="1" step=".001" value="0">


        </div>

    </body>
</html>
